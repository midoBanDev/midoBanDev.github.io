---
layout: single
title:  "[AWS] ELB(Elastic Load Balancer)"
categories:
  - Aws
tags:
  - [Aws, ELB]

toc: true
toc_sticky: true
---

## 

>ELB(Elastic Load Balancing)은 둘 이상의 가용 영역에서 EC2 인스턴스, 컨테이너, IP 주소 등 여러 대상에 걸쳐 수신되는 트래픽을 자동으로 분산합니다. 
>등록된 대상의 상태를 모니터링하면서 상태가 양호한 대상으로만 트래픽을 라우팅합니다.
>
>by AWS

ELB는 EC2만의 서비스가 아니다. 
EC2 인스턴스뿐만 아니라 다른 컨테이너 서비스, EKS 등에서도 사용된다.

우리가 지난 시간에 오토 스케일링 그룹에 대해서 배워봤어요. 그러면 오토 스케일링 그룹을 통해서 EC2 인스턴스의 숫자가 많아졌다가 줄어들었다가 하는 식으로 움직인다는 것을 제가 말씀드렸습니다. 그런데 여기에는 커다란 단점이 하나 있는데요. 
예를 들어 여러분께서 애플리케이션을 개발해서 수많은 웹 서버로 구성된 웹 서버 클러스터의 백엔드에 접속한다고 가정해 볼게요. 
문제가 뭐냐? 이렇게 각각의 EC2 인스턴스는 IP 주소를 가지고 있겠죠? 그러면 클라이언트가 어떤 IP 주소로 접속해야 하는지를 미리 다 알고 있어야 해요. 그래서 여기 접속했다가, 저기 접속했다가 하는 방식으로 접속을 해야 합니다.

이렇게 하려면 클라이언트가 모든 IP 정보를 가지고 있어야 하는데, 문제는 오토 스케일링입니다. 
EC2 인스턴스가 늘었다 줄었다 계속 변하기 때문에, 사람이 많을 때는 많아지고, 적을 때는 줄어드는 환경에서는 수십 대, 수백 대가 되면 클라이언트가 어떻게 구성되는지 감이 안 잡힐 수도 있어요. 
다시 말씀드리지만, EC2 인스턴스는 한두 대나 열 대가 아니라 100대, 심지어는 1,000대 단위로 운영되기 때문에 이런 것들을 효율적으로 관리할 수 있는 서비스가 필요합니다. 
그래서 나온 것이 ELB(Elastic Load Balancer)입니다.

ELB는 유저와 EC2 클러스터 중간에 위치하여 말 그대로 로드(부하)를 밸런싱(균형 조절)해 주는 서비스입니다. 
즉, 클라이언트는 각각의 EC2 인스턴스와 직접 소통하는 것이 아니라, 로드 밸런서와 소통하며, 로드 밸런서가 뒤에 있는 EC2 인스턴스로 트래픽을 전달하고, 응답을 받아 다시 전달하는 중개인 역할을 합니다.

이렇게 했을 때 몇 가지 장점이 있습니다. 
첫 번째, 사용자는 EC2 인스턴스 개별 IP 주소를 알 필요 없이 하나의 도메인으로만 계속 소통하면 됩니다. 뒤에서 어떤 일이 일어나는지는 알 필요가 없어요. 
두 번째, 장애가 발생하거나 여러 가지 이유로 특정 EC2 인스턴스가 트래픽을 받을 수 없는 경우, 똑똑한 로드 밸런서가 알아서 해당 EC2 인스턴스에는 트래픽을 주지 않습니다. 그래서 사용자 입장에서는 장애를 인지하지 못하고 정상적으로 서비스를 이용할 수 있습니다.

이게 바로 느슨한 연결입니다. 
우리가 클라우드 기초 개념을 배울 때 느슨한 연결에 대해 배웠었죠? 
클라이언트와 EC2 인스턴스가 직접 연결된 것이 아니라 로드 밸런서를 통해 느슨하게 연결되어 있기 때문에, 뒤에 있는 것들이 변하더라도 클라이언트는 변할 필요가 없는 굉장히 좋은 구조입니다.

ELB는 현재 기준으로 네 가지 종류가 있다.  
- 애플리케이션 로드 밸런서 (ALB)
- 네트워크 로드 밸런서 (NLB)
- 클래식 로드 밸런서 (CLB)
- 게이트웨이 로드 밸런서 (GLB)

ELB는 헬스 체크도 가능합니다. 
헬스 체크란 직접 트래픽을 발생시켜서 EC2 인스턴스가 살아 있는지를 체크하는 기능이다. 
헬스 체크 트래픽을 핸들할 수 있으면, "너는 트래픽을 받을 자격이 있어."라고 판단한다. 
반대로, 이를 제대로 처리하지 못하면 "어, 문제가 있네?" 하고 ELB가 해당 인스턴스로 별도로 트래픽을 보내지 않는다. 
그래서 클라이언트 입장에서 장애가 발생한 곳으로는 트래픽이 가지 않기 때문에 장애를 느낄 수가 없게 된다. 

ELB는 오토 스케일링과 연동이 가능하다.

일반적으로 지속적으로 IP 주소가 바뀌면 IP 고정이 불가능하다. 
그래서 항상 도메인 기반으로 사용하는 것이 올바른 방법이다. 
(네트워크 로드 밸런서의 기능 중 하나는 IP 고정이 가능)


### 애플리케이션 로드 밸런서(ALB, Application Load Balancer)
애플리케이션 로드 밸런서는 가장 많이 사용되는 로드 밸런서로, OSI 모델의 **레이어 7(애플리케이션 계층)**에서 작동한다. 

- 트래픽의 내용을 분석하고, 이를 기반으로 라우팅이 가능하다.
  - 예를 들어, 트래픽 내용 중 `image.sample.com`으로 온 요청은 이미지 서버로 전송하고, `web.sample.com`으로 온 요청은 웹 서버로 전송할 수 있다.
- 요청 내용에 따라 **유연한 트래픽 분산**이 가능하다. 헤더, URL, 쿼리 스트링 등 다양한 요소를 기반으로 경로 설정이 가능하다.

즉, **트래픽의 내용을 이해하고, 요청에 맞게 최적의 서버로 보내는 똑똑한 로드 밸런서** 이다.


### 네트워크 로드 밸런서(NLB, Network Load Balancer)
네트워크 로드 밸런서는 빠른 성능을 제공하는 로드 밸런서로, OSI 모델 4계층(Layer 4)에서 작동한다.

- 애플리케이션 로드 밸런서(Layer 7)보다 낮은 계층에서 동작하므로 **처리해야 할 정보량이 적어 속도가 빠르다.**  
- TCP, UDP 기반의 트래픽을 빠르게 분산처리 하며, 실시간 통신, 고속 데이터 처리가 필요한 경우에 적합하다.  
- Elastic IP 할당이 가능하기 때문에 고정 IP를 사용할 수 있다.
- ALB의 IP 고정이 필요하면 NLB 뒤에 배치 가능하다.
  - 네트워크 로드 밸런서를 애플리케이션 로드 밸런서 앞에 두어 IP 고정을 유지하는 방법도 있음  

즉, 빠르고 효율적인 트래픽 분산이 필요할 때 주로 사용하며, 고정 IP를 지원하는 것이 특징이다.


### 클래식 로드 밸런서(CLB, Classic Load Balancer)
과거에 사용되던 로드 밸런서로 현재는 거의 사용되지 않는다. 

- OSI 모델의 레이어 4(전송 계층) & 레이어 7(애플리케이션 계층) 지원
- 기능이 제한적 → ALB, NLB보다 유연한 트래픽 분산이 어려움  
- 현재는 주로 기존 시스템에서 유지보수 목적으로 사용됨
- AWS에서도 CLB 대신 ALB 또는 NLB 사용을 권장


### 게이트웨이 로드 밸런서(GLB, Gateway Load Balancer)
트래픽을 필터링하고 보안 검사를 먼저 수행하는 특수한 로드 밸런서이다.

- OSI 모델의 레이어 3(네트워크 계층)에서 동작한다. 
- 보안 장비(방화벽, IDS/IPS, DDoS 방어 시스템)와 연동 가능하다.
- 트래픽을 검증한 후 정상적인 트래픽만 내부 시스템으로 전달한다.
- 클라우드 보안이 중요한 환경에서 사용된다.

쉽게 말해 보안 게이트처럼 **악성 트래픽이 내부 시스템으로 들어오지 못하게 필터링하는 역할**을 한다. 
트래픽이 먼저 GLB를 통과해야 하고, 이상이 없으면 실제 서버로 전달된다. 
방화벽이나 침입 탐지 시스템(IDS/IPS)과 함께 쓰이는 경우가 많다.


### 🚀 AWS 로드 밸런서 4가지 종류 한눈에 정리

|  | **애플리케이션 로드 밸런서(ALB)** | **네트워크 로드 밸런서(NLB)** | **클래식 로드 밸런서(CLB)** | **게이트웨이 로드 밸런서(GLB)** |
|---|---|---|---|---|
| **주요 역할** | HTTP/HTTPS 기반으로 트래픽을 분석하고 라우팅 | TCP/UDP 기반으로 빠르게 트래픽을 분산 | 예전 로드 밸런싱 방식, 현재는 거의 사용 안 함 | 트래픽을 사전에 검사하여 보안 강화 |
| **OSI 계층** | **레이어 7 (애플리케이션 계층)** | **레이어 4 (전송 계층)** | 레이어 4(전송 계층), 일부 레이어 7(애플리케이션 계층) | **레이어 3 (네트워크 계층)** |
| **주요 기능** | URL, 헤더, 쿠키 기반 라우팅 / HTTPS 지원 / 다양한 규칙 설정 가능 | **빠른 트래픽 처리** / TCP, UDP, TLS 지원 / 고정 IP(엘라스틱 IP) 사용 가능 | 기본적인 트래픽 분산 (ALB, NLB보다 기능 부족) | **보안 장비(Firewall, IDS/IPS)와 연동**하여 악성 트래픽 차단 |
| **장점** | 트래픽을 분석해 최적의 서버로 연결하는 **똑똑한 로드 밸런서** | 속도가 빠르고, 네트워크 레벨에서 **고정 IP 제공 가능** | 예전에는 유용했으나 현재는 기능이 부족 | 보안 강화에 특화, **악성 트래픽을 차단하고 필터링** 가능 |
| **단점** | 속도는 NLB보다 느림, IP 고정 불가 | HTTP/HTTPS 기반 기능이 부족(단순 트래픽 분산) | ALB/NLB 대비 기능이 부족, 현재는 거의 사용 안 함 | 일반적인 로드 밸런싱이 아니라 보안 필터링 용도로 특화됨 |
| **현재 사용 여부** | **가장 많이 사용됨** | **빠른 속도가 필요한 경우 사용** | **AWS에서 ALB/NLB로 대체 권장** | **보안이 중요한 환경에서 사용** |
| **사용 예시** | 웹 서비스, API 서버, 마이크로서비스 | 게임 서버, 금융 시스템, 대용량 데이터 처리 | 기존 레거시 시스템 유지보수 | 방화벽, 침입 탐지 시스템(IDS/IPS), DDoS 방어 |

✅ **ALB → 가장 똑똑한 로드 밸런서 (HTTP/HTTPS 기반, 다양한 기능)**  
✅ **NLB → 가장 빠른 로드 밸런서 (TCP/UDP 기반, 고속 처리 & 고정 IP 가능)**  
✅ **CLB → 예전 방식, 현재는 거의 사용 안 함 (ALB/NLB 대체)**  
✅ **GLB → 보안 필터링을 위한 로드 밸런서 (악성 트래픽 차단 & 보호 역할!)**  








자, 그래서 이렇게 엘라스틱 로드 밸런서는 오토 스케일링과 찰떡궁합인데, 오토 스케일링을 통해 EC2 인스턴스 숫자를 관리하고, ELB를 통해 분산 트래픽을 처리하는 것이 EC2를 사용하는 일반적인 아키텍처입니다.  

그래서 오토 스케일링의 인스턴스 증감과 같이, EC2 인스턴스가 증감될 때 ELB와 함께 연동하여 이것을 관리하는 거예요. 그래서 이렇게 생긴 구조입니다.  

(07:29) 그래서 클라이언트는 로드 밸런서와 소통하고, 그 안에서 EC2 인스턴스가 올라갔다 내려갔다 하면서 숫자가 조절되는 것은 오토 스케일링 그룹으로 관리합니다. 이것이 일반적으로 EC2 인스턴스의 고가용성과 장애 내구성 등을 확보하기 위한 가장 일반적인 대처입니다.

<div style="padding-top:60px;"></div>
<span style="margin-left:35%;">⊙</span>
<span style="margin-left:10%">⊙</span>
<span style="margin-left:10%">⊙</span>
<div style="padding-top:60px;"></div>


<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>

