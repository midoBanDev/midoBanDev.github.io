---
layout: single
title:  "[AWS] EC2 생성(feat. 프리티어)"
categories:
  - Aws
tags:
  - [Aws, EC2]

toc: true
toc_sticky: true
---

## EC2 생성
검색 바에서 EC2를 검색해서 EC2 서비스로 이동한다. 
리소스 영역에 EC2 관련 리소스들을 한 번에 확인할 수 있다.
현재 하나의 EC2를 이미 생성한 상태여서 사용 중인 EC2 관련 리스스들이 표시되어 있다. 
EC2 생성 전 꼭 자신에게 맞는 리전(Region)을 선택해 줘햐 한다.

## 인스턴스 시작
아래 `인스턴스 시작`을 클릭해 준다.  
<img src="https://github.com/user-attachments/assets/b0bd6f46-67ee-4f02-ab73-18457ebd0adb" width="90%" height="80%"/>

<div style="padding-top:60px;"></div>
<span style="margin-left:35%;">⊙</span>
<span style="margin-left:10%">⊙</span>
<span style="margin-left:10%">⊙</span>
<div style="padding-top:60px;"></div>

## 인스턴스 전체 리소스 목록
아래 이미지에 있는 목록들은 EC2 인스턴스 관련 리소스 목록이다. 
최초 페이지가 로드되면 각 리소스들이 펼쳐진 상태로 보이는데 전체 목록으 확인하기 위해 모두 접어 놓은 상태이다. 
처음부터 하나씩 작성해 나가보자.  
<img src="https://github.com/user-attachments/assets/9215f14a-0b9f-426d-adeb-befb0fc1d5cf" width="90%" height="80%"/>

가장 처음 **EC2 인스턴스의 이름**을 생성한다.   
일반적으로 인스턴스에서 사용할 서비스를 이름을 통해 알 수 있도록 작성해 주는 것이 좋다. 
예를 들면 **주문 서비스 백엔드 프로젝트**를 사용할 인스턴스를 생성해 주는 경우 `order-service-api-server`의 형식으로 작성해 주는 것이 좋다. 
일반적으로 운영을 하다보면 여러 프로젝트가 쌓이기 때문에 EC2 인스턴스의 갯수가 수십개가 넘어가게 된다. 
따라서 최대한 이름을 직관적으로 작성해주자.  

<details>
<summary> 
<b><span>태그 사용법</span></b>
</summary>

<div markdown="1">

**태그의 개념 및 활용**

**태그(Tag)**는 AWS 리소스를 관리하고 식별하기 위해 사용되는 **키-값 쌍**이다.
예를 들어, 인스턴스에 `Name: order-service-api-server`라는 태그를 지정하면, 이 태그를 통해 해당 인스턴스를 쉽게 식별할 수 있다.  
<img src="https://github.com/user-attachments/assets/a18690ce-65f7-4271-aca6-09e2160a6af8" width="90%" height="80%"/>

---

**태그 활용 방법**  
1. **리소스 식별 및 관리**:
   - 태그를 사용하여 리소스의 용도, 소유자, 환경 등을 명확히 표시할 수 있다.
   - 예: `Environment: Production`, `Owner: John`.

2. **자동화 스크립트 및 정책 적용**:
   - AWS CLI나 SDK를 사용하여 특정 태그가 포함된 리소스만 관리하는 스크립트를 작성할 수 있다.
   - 예: 태그가 `Environment: Test`인 인스턴스만 자동으로 종료하거나 시작.

3. **비용 관리**:
   - 태그를 사용하여 리소스의 비용을 카테고리별로 분류할 수 있다.
   - 예: `Project: OrderService`로 태그를 지정하면, 비용 분석 시 해당 프로젝트와 관련된 리소스 사용량을 쉽게 파악 가능.

4. **권한 관리**:
   - IAM 정책에서 특정 태그를 기준으로 리소스에 대한 접근 권한을 제어할 수 있다.
   - 예: 태그가 `Department: IT`인 리소스만 특정 사용자에게 권한 부여.

5. **UI에서 필터링**:
   - AWS Management Console에서 태그를 사용해 리소스를 검색하거나 필터링할 수 있다.
   - 많은 리소스를 관리할 때 유용합니다.

---

**태그의 일반적인 사용 사례**  
인스턴스 목록에서 태그로 인스턴스를 조회할 수 있다.  
`키:값(포함), 키!:값(미포함)` 또는 `키=값(포함), 키!=값(미포함)` 형태로 검색하면 조건에 해당되는 인스턴스 목록이 조회된다.  
<img src="https://github.com/user-attachments/assets/1d01e6ab-ccbf-4935-b8fe-ba71af9e3573" width="90%" height="80%"/>

- **이름 태그(Name)**: 리소스의 이름을 지정해 콘솔에서 쉽게 식별.
  - 예: `Name: order-service-api-server`
- **환경 태그(Environment)**: 리소스가 운영 환경, 테스트 환경인지 구분.
  - 예: `Environment: Production`
- **소유자 태그(Owner)**: 리소스의 책임자 정보.
  - 예: `Owner: Jane Doe`.
- **프로젝트 태그(Project)**: 리소스가 속한 프로젝트를 구분.
  - 예: `Project: DataPipeline`.

---

**태그 사용 시 주의사항**  
1. **태그 제한**:
   - 하나의 리소스에는 최대 **50개의 태그**를 추가할 수 있다.
   - 키와 값은 각각 최대 128자(키)와 256자(값)까지 허용된다.

2. **비용 관련 태그 활성화**:
   - 비용 분석에 태그를 사용하려면 **AWS Billing and Cost Management** 콘솔에서 "사용자 정의 비용 할당 태그"를 활성화해야 한다.

3. **IAM 정책과 함께 사용**:
   - 태그를 기반으로 한 권한 관리를 설정할 때는 IAM 정책에서 태그 조건을 정확히 지정해야 한다.

</div>
</details>

<div style="padding-top:60px;"></div>
<span style="margin-left:35%;">⊙</span>
<span style="margin-left:10%">⊙</span>
<span style="margin-left:10%">⊙</span>
<div style="padding-top:60px;"></div>

## 애플리케이션 및 OS 이미지(AMI)
AMI는 인스턴스를 시작하는 데 필요한 소프트웨어 구성(운영 체제, 애플리케이션 서버 및 애플리케이션)이 포함된 템플릿이다. 
검색을 통해 원하는 AMI를 찾거나, 아래에 "Quick Start"에 표시된 AMI를 선택하여 사용할 수 있다.  

오른쪽 `더 많은 AMI 찾아보기`를 클릭하면 다양한 AMI 목록을 확인할 수 있다.

나는 Ubuntu를 선택했다. 아래 "Amazon Machine Image(AMI)"에 내가 선택한 AMI 상세 정보가 표시된다. 
또한 프리터어 사용 가능 여부도 표시해준다.  
<img src="https://github.com/user-attachments/assets/5f45068e-2bc4-4225-9d2f-b883a68e7b1e" width="90%" height="80%"/>

<div style="padding-top:60px;"></div>
<span style="margin-left:35%;">⊙</span>
<span style="margin-left:10%">⊙</span>
<span style="margin-left:10%">⊙</span>
<div style="padding-top:60px;"></div>

## 인스턴스 유형

<img src="https://github.com/user-attachments/assets/0b300f1e-13d9-4753-9b34-d325113a41d6" width="90%" height="80%"/>


<div style="padding-top:60px;"></div>
<span style="margin-left:35%;">⊙</span>
<span style="margin-left:10%">⊙</span>
<span style="margin-left:10%">⊙</span>
<div style="padding-top:60px;"></div>

## 키 페어(로그인)
키 페어는 기본적으로 EC2 인스턴스에 SSH를 사용하여 안전하게 연결하기 위한 인증 매커니즘이다. 
키 페어는 프라이빗 키와 퍼블릭 키가 존재한다.
- **프라이빗 키**: 키 페어 생성 시 사용자에게 파일 형태로 다운로드 해 준다. 인스턴스에 접속할 때 사용된다.
- **퍼블릭 키**: 키 페어 생성 시 AWS가 EC2 인스턴스에 자동으로 저장한다. 접속 요청 시 인증 과정을 처리한다.

<img src="https://github.com/user-attachments/assets/5643a34c-d98f-4a18-a3c7-c541897d3d28" width="90%" height="80%"/>

`새 키 페어 생성`를 클릭하면 키 페어 생성 레이어가 열린다. 
키 페어 이름을 작성해 준다. 자유롭게 작성하되, 어떤 인스턴스의 키페어 인지 확인할 수 있는 이름으로 작성하는 것이 좋다. 
예를 들어 인스턴스 명이 `order-service-api-server`라면 `order-service-api-server-key-pair` 로 작성해 주는 것이 좋다.  

키 페어 유형과 프라이빗 키 파일 형식은 기본 값으로 생성한다. 

아래 `키 페어 생성`을 클릭하면 바로 키 페어가 생성되고 즉시 프라이빗 키 페어 파일이 다운로드 된다. 
프라이빗 키는 한 번만 다운로드할 수 있기 때문에 안전한 위치에 저장해야 한다. 
<img src="https://github.com/user-attachments/assets/22d4bbab-4323-486a-a715-809f548568f4" width="90%" height="80%"/>

<br>

### 만약 프라이빗 키를 분실한 경우
<details>
<summary> 
<b><span>새 키 페어 적용 방법</span></b>
</summary>

<div markdown="1">


방법은 간단하다. 새로운 키 페어를 생성한 후 다운로드 한 프라이빗 키를 가지고 퍼블릭 키를 만든다. 
그리고 인스턴스에 접근하여 기존 퍼블릭 키를 새로 만든 퍼블릭 키로 변경해준다. 

이때 핵심은 인스턴스에 접근을 할 수 있어야 한다. AWS의 인스턴스 서비스로 이동하여 연결 옵션을 통해 키 페어 없이 접속이 가능하다. 
단, 인스턴스가 실행 중이여야 한다. 

만약 인스턴스가 실행 중이지 않은 상황에서 접속하려면 "Systems Manager"를 통해 접속 해야하는데, 조건이 인스턴스에 Systems Manager 에이전트가 설치되어 있어야 하고, IAM 역할이 설정되어 있어야 한다. 

따라서 일단 AWS의 인스턴스 서비스의 연결 옵션을 통해 접속이 가능하다는 전제로 설명한다.

**1. 새로운 키 페어 생성**  
키 페어 메뉴로 접근한다. 접근방법은 크게 아래 두 가지 방법이 있다.
- 해당 인스턴스 세부 정보 > "시작 시 할당된 키 페어" 항목의 키 페어 이름을 클릭한다.
- 왼쪽 메뉴의 키 페어 클릭하여 키 페어 메뉴에 접근한다. 

우측 상단에 `키 페어 생성` 버튼을 클릭해서 새로운 키 페어를 생성해 준다. 
다운로드 받은 프라이빗 키를 원하는 디렉터리에 이동시켜 보관한다. 

프라이빗 키를 사용해 대응되는 퍼블릭 키를 생성할 수 있다. 
프라이빗 키는 비대칭 암호화 방식에서 고유의 수학적 관계를 통해 퍼블릭 키를 유도할 수 있기 때문이다.

<br>

**2. 퍼블릭 키 추출**  
퍼블릭 키를 추출방법  
```bash
$ ssh-keygen -y -f <프라이빗_키_파일>.pem > new_public_key.pub
```

<br>

**3. AWS EC2 콘솔의 "연결" 옵션을 통해 접속하여 퍼블릭 키 교체**  
추출한 new_public_key.pub를 인스턴스의 `~/.ssh/authorized_keys`에 추가한다.

</div>
</details>

<div style="padding-top:60px;"></div>
<span style="margin-left:35%;">⊙</span>
<span style="margin-left:10%">⊙</span>
<span style="margin-left:10%">⊙</span>
<div style="padding-top:60px;"></div>

## 네트워크 설정

<img src="https://github.com/user-attachments/assets/7aa1d746-38af-4622-bda6-43287383eb81" width="90%" height="80%"/>

<img src="https://github.com/user-attachments/assets/65550675-0325-4209-9c89-7b36f275e3d7" width="90%" height="80%"/>
<img src="https://github.com/user-attachments/assets/bff167df-61e7-482a-bc84-aa558e814206" width="90%" height="80%"/>

<div style="padding-top:60px;"></div>
<span style="margin-left:35%;">⊙</span>
<span style="margin-left:10%">⊙</span>
<span style="margin-left:10%">⊙</span>
<div style="padding-top:60px;"></div>

## 스토리지 구성

<img src="https://github.com/user-attachments/assets/8a40b83d-3b39-492c-b840-cd447deeb582" width="90%" height="80%"/>
<img src="https://github.com/user-attachments/assets/378b71fd-e25b-4a4e-a7f1-122001bae3ab" width="90%" height="80%"/>
<img src="https://github.com/user-attachments/assets/d960e35d-531f-41d1-bc68-3b81d324669f" width="90%" height="80%"/>


<div style="padding-top:60px;"></div>
<span style="margin-left:35%;">⊙</span>
<span style="margin-left:10%">⊙</span>
<span style="margin-left:10%">⊙</span>
<div style="padding-top:60px;"></div>


<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>
<img src="" width="90%" height="80%"/>

